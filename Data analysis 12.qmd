---
title: "Data analysis project 12"
format: html
editor: visual
execute: 
  echo: false
---

```{r}
#| echo: false
#| warning: false
#| message: false

library(dplyr)
library(ggplot2) 
library(tidyverse)
library(tidymodels)
library(performance)
library(tinytex)
library(skimr)
library(kableExtra)


obesity <- read.csv("~/Downloads/DAProject12.csv")
BMI <- obesity
glimpse(obesity)
colSums(is.na(obesity))
```

# Introduction {#sec-intro}

Over the years, there has been an increase in the health awareness of the Scottish population, with a fear that the country as a whole is becoming overweight. **The body mass index (BMI)** is a quick way to measure weight relative to height, and screen for people that are underweight, overweight, or obese.

This report aims to explore **changes in BMI trends in Scotland** using data from the **2013--2016 Scottish Health Survey**. Specifically, we seek to answer the following key questions:

1.  **Has the BMI in Scotland changed over the given years of the Scottish Health Survey?**
2.  **Are there any difference in the BMI distributions by age, gender, socio-economic status or lifestyle factors?**

By analyzing this data, we aim to identify patterns that could inform public health strategies and address potential risk factors contributing to obesity.

# Exploratory data analysis {#sec-expdata}

## Data Overview

```{r}
head(obesity)
glimpse(obesity)
colSums(is.na(obesity))
```

The dataset consists of 14,017 observations with the following columns:

**Age**: Age of individuals

**Sex**: Gender of individuals (Male/Female)

**Education**: Highest educational qualification

**Year**: Year of the survey (2013-2016)

**BMIgroup**: Weight classification group (e.g., Obese, Overweight, Normal)

## Summary Statistics

Computing descriptive statistics helps understand the distribution of the data.

```{r}
summary_table <- obesity %>% 
  summarise(
    Sample_Size = n(),
    Mean_Age = mean(Age, na.rm = TRUE),
    Median_Age = median(Age, na.rm = TRUE),
    Min_Age = min(Age, na.rm = TRUE),
    Q1_Age = quantile(Age, 0.25, na.rm = TRUE),
    Q3_Age = quantile(Age, 0.75, na.rm = TRUE),
    Max_Age = max(Age, na.rm = TRUE),
    Std_Age = sd(Age, na.rm = TRUE)
  )

kable(summary_table, caption = "Summary Statistics of the Dataset") %>% 
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

```{r}
kable(summary_table, caption = "Summary Statistics of the Dataset") %>% 
kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))
```

Key observations from the summary statistics:

-   No missing values are detected.

-   Age distribution is fairly wide, with a range from young adults to elderly individuals.

-   BMI categories contain multiple classifications, which will later be converted into a binary variable for analysis.

## Identifying Distribution and Checking Normality

We use a histogram to visualize the distribution of age and assess normality.

```{r}
ggplot(obesity, aes(x = Age)) +
  geom_histogram(binwidth = 5, fill = "#2c3e50", color = "white", alpha = 0.8) +
  theme_minimal() +
  labs(title = "Histogram of Age Distribution", x = "Age", y = "Count")
```

The histogram reveals that the age distribution in the dataset is approximately **bell-shaped** but slightly **right-skewed**. The majority of individuals fall within the **40-60 age range**, while younger individuals (\<20 years) and older individuals (\>80 years) are less represented. The right skew suggests that there are **more older individuals in the dataset than younger ones**. While the distribution is close to normal, further statistical tests such as a **Q-Q plot** can confirm normality.

While the distribution is close to normal, further statistical tests such as a **Q-Q plot** can confirm normality.

```{r}
ggplot(obesity, aes(sample = Age)) +
  stat_qq() +
  stat_qq_line() +
  theme_minimal() +
  labs(title = "Q-Q Plot for Age Distribution", x = "Theoretical Quantiles", y = "Sample Quantiles")
```

The **Q-Q plot** provides further insights into the normality of the age distribution. Ideally, if the data follows a normal distribution, the points should closely follow the **diagonal reference line**. However, in the plot:

-   The points deviate from the **diagonal line at both tails**, suggesting that the age distribution has **heavy tails** and potential skewness.

-   The slight **concave shape** indicates a **right-skewed distribution**, aligning with what was observed in the histogram.

-   This suggests that the data may **not be perfectly normally distributed**, which could influence statistical modeling that assumes normality.

## Identifying outliers:

To detect outliers, we use a **boxplot** to visualize the spread of ages within each 

```{r}
ggplot(obesity, aes(x = BMIgroup, y = Age)) +
  geom_boxplot(fill = "#2c3e50", color = "white") +
  theme_minimal() +
  labs(title = "Boxplot of Age by BMI Group", x = "BMI Group", y = "Age")
```

The boxplot provides a visual summary of the distribution of **age across different BMI categories (Normal, Obese, Overweight, and Underweight)**. Key observations include:

-   The **median age varies slightly across BMI groups**, with individuals classified as overweight and obese tending to be older than those in the normal or underweight categories.

-   The **interquartile range (IQR)** (middle 50% of the data) shows that most individuals are between **40 and 70 years old**, regardless of BMI classification.

-   There are **potential outliers**, particularly among **younger and older individuals**, indicating that some individuals outside the usual age range may require further investigation.

## Creating a Binary Obesity Classification

Since we want to analyze obesity prevalence, we create a new binary response variable where:

-   Obese = 1

-   Not Obese (Normal & Overweight) = 0

```{r}
obesity <- obesity %>% 
  mutate(ObeseBinary = ifelse(BMIgroup == "Obese", 1, 0))

# Check the new variable
table(obesity$ObeseBinary)
```

## BMI Trends Over Time

Analyzing how obesity has changed over time using proportions.

```{r}
bmi_trends <- obesity %>%
  group_by(Year, BMIgroup) %>%
  summarise(count = n(), .groups = "drop") %>%
  group_by(Year) %>%
  mutate(proportion = count / sum(count))

# Visualization
ggplot(bmi_trends, aes(x = factor(Year), y = proportion, fill = BMIgroup)) +
  geom_bar(stat = "identity", position = "stack") +
  theme_minimal() +
  labs(title = "BMI Trends Over Time", x = "Year", y = "Proportion", fill = "BMI Group")
```

Key findings:

-   The proportion of obese individuals appears relatively stable over the years.

-   A significant proportion of individuals are classified as overweight.

## Obesity Distribution by Demographics

### By Age Group

```{r}
obesity$AgeGroup <- cut(obesity$Age, breaks = c(0, 18, 30, 45, 60, 75, 100),
                    labels = c("<18", "18-30", "30-45", "45-60", "60-75", "75+"))

obesity_age_counts <- obesity %>% filter(ObeseBinary == 1) %>%
  group_by(AgeGroup) %>% summarise(Count = n())

ggplot(obesity_age_counts, aes(x = AgeGroup, y = Count, fill = AgeGroup)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Obesity Prevalence by Age Group", x = "Age Group", y = "Count of Obese Individuals")
```

-   Middle-aged individuals (45-60) have the highest obesity rates.

### By Gender

```{r}
obesity_sex_counts <- obesity %>% filter(ObeseBinary == 1) %>%
  group_by(Sex) %>% summarise(Count = n())

ggplot(obesity_sex_counts, aes(x = Sex, y = Count, fill = Sex)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Obesity Prevalence by Sex", x = "Sex", y = "Count of Obese Individuals")
```

-   Females exhibit higher obesity rates compared to males.

# Correlation Analysis

Examining the relationship between **Age** and **Obesity**.

```{r}
cor.test(obesity$Age, obesity$ObeseBinary, method = "pearson")
```

The correlation is 0.099 which is suggesting a weak linear relationship \# Age vs. Obesity

```{r}
ggplot(obesity, aes(x = Age, y = ObeseBinary)) +
  geom_jitter(alpha = 0.3, color = "#2c3e50") +
  theme_minimal() +
  labs(title = "Scatterplot of Age vs. Obesity", x = "Age", y = "Obesity (1 = Obese, 0 = Not Obese)")
```

```{r}

bmi_trends <- obesity%>% group_by(Year, BMIgroup) %>% summarise(count = n(), .groups =
"drop") %>% group_by(Year) %>% mutate(proportion = count / sum(count))

```

# Formal data analysis {#sec-formdata}

| Year | Obese proportions |
|------|-------------------|
| 2013 | 0.30300569        |
| 2014 | 0.30181715        |
| 2015 | 0.30645161        |
| 2016 | 0.30536494        |

```{r}
bmi_trends <- bmi_trends %>%
  mutate(obese_binary = ifelse(BMIgroup == "Obese", 1, 0))

```

```{r}
#| echo: false
bmi_trends$BMIgroup<-as.factor(bmi_trends$BMIgroup)
levels(bmi_trends$BMIgroup)<-c("Not Obese","Obese","Not Obese","Not Obese")
trend_table <- table(bmi_trends$Year, bmi_trends$obese_binary)
head(trend_table)
prop.trend.test(x = trend_table[,2],  
                n = rowSums(trend_table))  
unique(bmi_trends$Year)
unique(bmi_trends$obese_binary)
bmi_trends$Year<-as.factor(bmi_trends$Year)
chisq.test(trend_table)
```

```{r}
glm_model <- glm(obese_binary ~ as.numeric(Year), 
                 data = bmi_trends, family = binomial)
summary(glm_model)

```

### Question 2

To answer the second question, we use linear regression to find out if age, gender, socio-economic status, or lifestyle factors are significant predictors for obesity.

We start by looking at if age is a significant predictor.

```{r}
#| echo: false
#| eval: true
BMI$BMIgroup <- as.factor(BMI$BMIgroup)
levels(BMI$BMIgroup) <- c("Not Obese", "Obese", "Not Obese", "Not Obese")

# Regression to check if Age is a significant predictor
model_age <- glm(BMIgroup ~ Age,
                     data = BMI,
                     family = binomial)

# Interpretation is in log-odds!
model_age %>% tidy(conf.int = T)

# Model diagnostics - Checking for overdispersion
check_overdispersion(model_age)
```

We now look at sex to consider if it is significant

```{r}
#| echo: false
#| eval: true
# Regression to check if Sex is a significant predictor
model_sex <- glm(BMIgroup ~ Sex,
                     data = BMI,
                     family = binomial)

# Interpretation is in the log-odds scale
model_sex %>% tidy(conf.int = T) # P-value of 0.0247 -> sex is significant

# Then checking for overdispersion
check_overdispersion(model_sex)
```

We now look at education to consider if there is a difference in obesity based on socio-economic factors

```{r}
#| echo: false
#| eval: true
# Regression to check if the various levels of education are significant as predictors
model_edu <- glm(BMIgroup ~ Education,
                     data = BMI,
                     family = binomial)

# interpretation is in the log-odds scale
model_edu %>% tidy(conf.int = T) # All are significant

# We again check for overdispersion
check_overdispersion(model_edu)
```

## Results {#sec-results}

# Conclusions {#sec-conc}

> > > > > > > Formal-Analysis-Q2
